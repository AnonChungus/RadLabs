<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RadLabs | Bitcoin Runes Trading</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- TradingView Lightweight Charts -->
  <script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>
  <style>
    :root {
      /* Miami Vice Modern Palette */
      --miami-pink: #ff2d92;
      --miami-cyan: #00d4ff;
      --miami-purple: #9945ff;
      --miami-orange: #ff6b35;
      --miami-sunset: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      
      /* Matrix Numbers */
      --matrix-green: #00ff41;
      --matrix-dim: #00cc33;
      
      /* Modern Apple-style */
      --glass-bg: rgba(255,255,255,0.03);
      --glass-border: rgba(255,255,255,0.08);
      --card-bg: rgba(20,20,35,0.8);
      --card-border: rgba(255,255,255,0.06);
      
      /* Base */
      --bg-primary: #0a0a12;
      --bg-secondary: #0f0f1a;
      --text-primary: #ffffff;
      --text-secondary: rgba(255,255,255,0.6);
      --text-muted: rgba(255,255,255,0.4);
      
      /* Status */
      --green: #00ff88;
      --red: #ff4757;
      --yellow: #ffd93d;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    /* ===== BACKGROUND ===== */
    .bg-gradient {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: 
        radial-gradient(ellipse at 20% 20%, rgba(255,45,146,0.15) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(0,212,255,0.1) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 50%, rgba(153,69,255,0.05) 0%, transparent 70%),
        var(--bg-primary);
      z-index: -2;
    }
    
    .bg-grid {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-image: 
        linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
      background-size: 60px 60px;
      z-index: -1;
    }
    
    /* Palm tree decorations */
    .palm-left, .palm-right {
      position: fixed;
      bottom: 0;
      width: 200px;
      height: 400px;
      opacity: 0.1;
      z-index: -1;
      background-size: contain;
      background-repeat: no-repeat;
      filter: hue-rotate(280deg);
    }
    .palm-left { left: 0; }
    .palm-right { right: 0; transform: scaleX(-1); }
    
    /* ===== LOTTERY BANNER ===== */
    .lottery-banner {
      background: linear-gradient(90deg, rgba(255,45,146,0.1), rgba(0,212,255,0.1), rgba(153,69,255,0.1));
      border-bottom: 1px solid var(--glass-border);
      padding: 0.6rem 2rem;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 2rem;
      font-size: 0.85rem;
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(20px);
    }
    
    .lottery-banner .item {
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
    
    .lottery-banner .item .label {
      color: var(--text-secondary);
    }
    
    .lottery-banner .item .val {
      color: var(--yellow);
      font-weight: 600;
    }
    
    .lottery-banner .jackpot {
      font-size: 1rem;
      font-weight: 700;
      color: var(--miami-pink);
      text-shadow: 0 0 10px rgba(255,45,146,0.5);
    }
    
    /* ===== HEADER ===== */
    header {
      position: sticky;
      top: 42px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1.5rem 2rem;
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--glass-border);
      z-index: 99;
    }
    
    .logo-wrapper {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1.6rem;
      font-weight: 800;
      letter-spacing: -0.5px;
    }
    
    .logo-img {
      width: 48px;
      height: 48px;
      position: relative;
    }
    
    .logo-text .rad {
      color: #000;
      -webkit-text-stroke: 2px var(--miami-orange);
      text-stroke: 2px var(--miami-orange);
      paint-order: stroke fill;
    }
    
    .logo-text .labs {
      color: var(--miami-orange);
    }
    
    .nav {
      display: flex;
      gap: 0.5rem;
    }
    
    .nav a {
      position: relative;
      padding: 0.6rem 1.2rem;
      color: var(--text-secondary);
      text-decoration: none;
      font-weight: 500;
      border-radius: 8px;
      transition: all 0.2s ease;
      background: transparent;
    }
    
    .nav a:hover {
      color: var(--text-primary);
      background: rgba(255,255,255,0.05);
    }
    
    .nav a.active {
      color: var(--text-primary);
      background: linear-gradient(135deg, rgba(0,0,0,0.6), rgba(255,255,255,0.1));
      border: 1px solid;
      border-image: linear-gradient(135deg, var(--miami-pink), var(--miami-cyan), var(--miami-purple)) 1;
      box-shadow: 0 4px 15px rgba(255,45,146,0.2);
    }
    
    .connect-btn {
      background: linear-gradient(135deg, rgba(0,0,0,0.6), rgba(255,255,255,0.1));
      border: 1px solid transparent;
      border-image: linear-gradient(135deg, var(--miami-pink), var(--miami-cyan), var(--miami-purple)) 1;
      color: var(--text-primary);
      padding: 0.7rem 1.5rem;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.95rem;
    }
    
    .connect-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255,45,146,0.3);
    }
    
    .connect-btn.connected {
      background: linear-gradient(135deg, rgba(0,255,136,0.1), rgba(0,255,136,0.05));
      border-image: linear-gradient(135deg, var(--green), var(--matrix-green)) 1;
    }
    
    /* ===== TOAST ===== */
    .toast {
      position: fixed;
      top: 120px;
      right: 20px;
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      padding: 1rem 1.5rem;
      color: var(--text-primary);
      box-shadow: 0 10px 40px rgba(0,0,0,0.4);
      animation: slideIn 0.3s ease;
      z-index: 1000;
      max-width: 350px;
    }
    
    @keyframes slideIn {
      from { transform: translateX(400px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    .toast.success { border-left: 4px solid var(--green); }
    .toast.error { border-left: 4px solid var(--red); }
    .toast.info { border-left: 4px solid var(--miami-cyan); }
    
    /* ===== PAGES ===== */
    .page {
      display: none;
      padding: 2rem;
      max-width: 1600px;
      margin: 0 auto;
    }
    
    .page.active {
      display: block;
    }
    
    /* ===== RADPAD ===== */
    .radpad-header {
      text-align: center;
      margin-bottom: 3rem;
    }
    
    .radpad-header h1 {
      font-size: 3rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--miami-pink), var(--miami-cyan), var(--miami-purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
    }
    
    .radpad-header p {
      font-size: 1.1rem;
      color: var(--text-secondary);
    }
    
    .etch-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
    }
    
    .etch-card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 16px;
      padding: 2rem;
      backdrop-filter: blur(20px);
    }
    
    .etch-card h2 {
      font-size: 1.5rem;
      margin-bottom: 1.5rem;
      color: var(--text-primary);
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-group label {
      display: block;
      font-size: 0.9rem;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
      font-weight: 500;
    }
    
    .form-group input,
    .form-group textarea {
      width: 100%;
      background: rgba(0,0,0,0.3);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      padding: 0.75rem 1rem;
      color: var(--text-primary);
      font-family: 'Inter', sans-serif;
      font-size: 0.95rem;
      transition: all 0.2s ease;
    }
    
    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--miami-cyan);
      box-shadow: 0 0 0 3px rgba(0,212,255,0.1);
    }
    
    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }
    
    .slider-group {
      margin-bottom: 1.5rem;
    }
    
    .slider-group label {
      display: block;
      font-size: 0.9rem;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
      font-weight: 500;
    }
    
    .slider-value {
      float: right;
      color: var(--miami-cyan);
      font-weight: 600;
    }
    
    .slider-group input[type="range"] {
      width: 100%;
      height: 6px;
      background: rgba(0,0,0,0.3);
      border-radius: 10px;
      outline: none;
      -webkit-appearance: none;
    }
    
    .slider-group input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      background: var(--miami-cyan);
      cursor: pointer;
      border-radius: 50%;
      box-shadow: 0 2px 10px rgba(0,212,255,0.5);
    }
    
    .slider-group input[type="range"]::-moz-range-thumb {
      width: 20px;
      height: 20px;
      background: var(--miami-cyan);
      cursor: pointer;
      border-radius: 50%;
      box-shadow: 0 2px 10px rgba(0,212,255,0.5);
      border: none;
    }
    
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
      padding: 1rem;
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
    }
    
    .checkbox-group input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }
    
    .checkbox-group label {
      margin: 0;
      cursor: pointer;
      user-select: none;
    }
    
    .etch-preview {
      background: rgba(0,0,0,0.3);
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    
    .etch-preview h3 {
      font-size: 1.2rem;
      margin-bottom: 1rem;
      color: var(--miami-cyan);
    }
    
    .preview-item {
      display: flex;
      justify-content: space-between;
      padding: 0.75rem 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    
    .preview-item:last-child {
      border-bottom: none;
    }
    
    .preview-item .label {
      color: var(--text-secondary);
    }
    
    .preview-item .value {
      color: var(--text-primary);
      font-weight: 600;
    }
    
    .etch-btn {
      width: 100%;
      background: linear-gradient(135deg, rgba(0,0,0,0.6), rgba(255,255,255,0.1));
      border: 2px solid transparent;
      border-image: linear-gradient(135deg, var(--miami-pink), var(--miami-cyan), var(--miami-purple)) 1;
      color: var(--text-primary);
      padding: 1rem 2rem;
      border-radius: 12px;
      font-weight: 700;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .etch-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(255,45,146,0.3);
    }
    
    .etch-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .etch-info {
      background: rgba(0,212,255,0.1);
      border: 1px solid rgba(0,212,255,0.3);
      border-radius: 8px;
      padding: 1rem;
      margin-top: 1rem;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }
    
    .etch-list {
      margin-top: 3rem;
    }
    
    .etch-list h2 {
      font-size: 2rem;
      margin-bottom: 1.5rem;
      text-align: center;
    }
    
    .etch-items {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
    }
    
    .etch-item {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      padding: 1.5rem;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .etch-item:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 30px rgba(255,45,146,0.2);
    }
    
    .etch-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    
    .etch-item-name {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--miami-cyan);
    }
    
    .etch-item-symbol {
      background: rgba(255,45,146,0.2);
      border: 1px solid var(--miami-pink);
      padding: 0.25rem 0.75rem;
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: 600;
    }
    
    .etch-item-description {
      color: var(--text-secondary);
      font-size: 0.9rem;
      margin-bottom: 1rem;
      line-height: 1.5;
    }
    
    .etch-item-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
    }
    
    .etch-item-stat {
      background: rgba(0,0,0,0.3);
      padding: 0.5rem;
      border-radius: 6px;
    }
    
    .etch-item-stat .label {
      font-size: 0.75rem;
      color: var(--text-muted);
      display: block;
      margin-bottom: 0.25rem;
    }
    
    .etch-item-stat .value {
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--matrix-green);
    }
    
    .etch-item-socials {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }
    
    .social-link {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      background: rgba(0,0,0,0.3);
      border: 1px solid var(--glass-border);
      border-radius: 6px;
      color: var(--text-secondary);
      text-decoration: none;
      transition: all 0.2s ease;
    }
    
    .social-link:hover {
      background: rgba(0,212,255,0.1);
      border-color: var(--miami-cyan);
      color: var(--miami-cyan);
    }
    
    /* Add common styles we'll need */
    .trade-grid, .mm-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 2rem;
    }
    
    .chart-card, .swap-module, .mm-card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 16px;
      padding: 1.5rem;
      backdrop-filter: blur(20px);
    }
    
    .chart-video-bg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0.5;
      pointer-events: none;
    }
    
    .mute-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0,0,0,0.6);
      border: 1px solid var(--glass-border);
      color: white;
      padding: 0.5rem;
      border-radius: 6px;
      cursor: pointer;
      z-index: 10;
      font-size: 1.2rem;
    }
    
    .table-card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 16px;
      padding: 1.5rem;
      backdrop-filter: blur(20px);
      overflow-x: auto;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
    }
    
    thead th {
      text-align: left;
      padding: 1rem;
      color: var(--text-secondary);
      font-weight: 600;
      font-size: 0.85rem;
      text-transform: uppercase;
      border-bottom: 1px solid var(--glass-border);
    }
    
    tbody tr {
      border-bottom: 1px solid rgba(255,255,255,0.03);
      transition: background 0.2s ease;
      cursor: pointer;
    }
    
    tbody tr:hover {
      background: rgba(255,255,255,0.02);
    }
    
    tbody td {
      padding: 1rem;
      color: var(--text-primary);
    }
    
    .mm-header, .tokens-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    
    .mm-header h1, .tokens-header h1 {
      font-size: 2.5rem;
      font-weight: 800;
      margin-bottom: 0.5rem;
    }
    
    .mm-header p, .tokens-header p {
      color: var(--text-secondary);
      font-size: 1.1rem;
    }
  </style>
</head>
<body>
  <div class="bg-gradient"></div>
  <div class="bg-grid"></div>
  
  <!-- Lottery Banner -->
  <div class="lottery-banner">
    <div class="item">
      <span class="label">Daily Lottery:</span>
      <span class="jackpot">0.25% of fees</span>
    </div>
    <div class="item">
      <span class="label">Next Draw:</span>
      <span class="val" id="nextDraw">12:00 UTC</span>
    </div>
    <div class="item">
      <span class="label">Today's Pot:</span>
      <span class="val" id="todayPot">Loading...</span>
    </div>
  </div>
  
  <!-- Header -->
  <header>
    <div class="logo-wrapper">
      <div class="logo-img">
        <svg width="48" height="48" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="liquidGrad" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#00ff88;stop-opacity:0.9" />
              <stop offset="100%" style="stop-color:#00cc66;stop-opacity:0.7" />
            </linearGradient>
            <filter id="glow">
              <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
              <feMerge>
                <feMergeNode in="coloredBlur"/>
                <feMergeNode in="SourceGraphic"/>
              </feMerge>
            </filter>
          </defs>
          <ellipse cx="100" cy="155" rx="50" ry="30" fill="url(#liquidGrad)" opacity="0.3"/>
          <path d="M 70 150 Q 70 80, 100 80 Q 130 80, 130 150 Q 130 170, 100 170 Q 70 170, 70 150 Z" 
                fill="none" stroke="#00ff88" stroke-width="4" filter="url(#glow)"/>
          <path d="M 70 150 Q 70 100, 100 100 Q 130 100, 130 150" 
                fill="url(#liquidGrad)" opacity="0.6"/>
          <circle cx="90" cy="120" r="3" fill="#ffffff" opacity="0.8">
            <animate attributeName="cy" values="120;110;120" dur="2s" repeatCount="indefinite"/>
          </circle>
          <circle cx="100" cy="130" r="4" fill="#ffffff" opacity="0.9">
            <animate attributeName="cy" values="130;115;130" dur="2.5s" repeatCount="indefinite"/>
          </circle>
          <circle cx="110" cy="125" r="3" fill="#ffffff" opacity="0.7">
            <animate attributeName="cy" values="125;112;125" dur="2.2s" repeatCount="indefinite"/>
          </circle>
          <rect x="95" y="70" width="10" height="15" fill="#00ff88" opacity="0.8"/>
          <ellipse cx="100" cy="70" rx="6" ry="3" fill="#00ff88"/>
        </svg>
      </div>
      <span class="logo-text"><span class="rad">Rad</span><span class="labs">Labs</span></span>
    </div>
    
    <nav class="nav">
      <a href="#" class="active" data-page="trade">Trade</a>
      <a href="#" data-page="tokens">Tokens</a>
      <a href="#" data-page="radpad">RadPad</a>
      <a href="#" data-page="liquidity">Liquidity</a>
      <a href="#" data-page="market-maker">Market Maker</a>
    </nav>
    
    <button class="connect-btn" id="connectBtn" onclick="doConnect()">Connect Wallet</button>
  </header>

  <!-- TRADE PAGE (kept minimal for now, will expand later) -->
  <div class="page active" id="page-trade">
    <div style="text-align: center; padding: 4rem 2rem;">
      <h1 style="font-size: 3rem; margin-bottom: 1rem;">üöß Trade Module Coming Soon</h1>
      <p style="color: var(--text-secondary); font-size: 1.2rem;">Building the most advanced Bitcoin Runes trading experience</p>
    </div>
  </div>

  <!-- TOKENS PAGE -->
  <div class="page" id="page-tokens">
    <div class="tokens-header">
      <h1>All Tokens</h1>
      <p>Explore all Runes tokens on RadFi</p>
    </div>
    <div class="table-card">
      <input type="text" placeholder="Search tokens..." onkeyup="filterTable(this.value)" 
             style="width: 100%; padding: 0.75rem 1rem; margin-bottom: 1rem; background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); border-radius: 8px; color: white;">
      <table>
        <thead>
          <tr>
            <th>Token</th>
            <th>Market Cap</th>
            <th>Volume 24h</th>
            <th>Liquidity</th>
            <th>Change</th>
          </tr>
        </thead>
        <tbody id="tokenTbody"></tbody>
      </table>
    </div>
  </div>

  <!-- RADPAD PAGE -->
  <div class="page" id="page-radpad">
    <div class="radpad-header">
      <h1>üöÄ RadPad</h1>
      <p>Launch your Rune on Bitcoin with instant liquidity</p>
    </div>
    
    <div class="etch-grid">
      <!-- Left: Rune Details -->
      <div class="etch-card">
        <h2>Rune Details</h2>
        
        <div class="form-group">
          <label>Rune Name *</label>
          <input type="text" id="runeName" placeholder="UNCOMMON‚Ä¢GOODS" 
                 onkeyup="updatePreview()">
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label>Symbol *</label>
            <input type="text" id="symbol" placeholder="UG" maxlength="4"
                   onkeyup="updatePreview()">
          </div>
          
          <div class="form-group">
            <label>Display Ticker</label>
            <input type="text" id="displayTicker" placeholder="UG"
                   onkeyup="updatePreview()">
          </div>
        </div>
        
        <div class="form-group">
          <label>Description *</label>
          <textarea id="description" placeholder="Describe your Rune project..."
                    onkeyup="updatePreview()"></textarea>
        </div>
        
        <div class="form-group">
          <label>Inscription Type</label>
          <input type="text" id="inscriptionType" value="text/plain" readonly>
        </div>
        
        <div class="form-group">
          <label>Inscription Content</label>
          <textarea id="inscriptionContent" placeholder="Additional inscription data..."
                    onkeyup="updatePreview()"></textarea>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label>Twitter/X</label>
            <input type="text" id="socialX" placeholder="https://x.com/yourproject"
                   onkeyup="updatePreview()">
          </div>
          
          <div class="form-group">
            <label>Telegram</label>
            <input type="text" id="socialTg" placeholder="https://t.me/yourproject"
                   onkeyup="updatePreview()">
          </div>
        </div>
      </div>
      
      <!-- Right: Launch Parameters -->
      <div class="etch-card">
        <h2>Launch Parameters</h2>
        
        <div class="slider-group">
          <label>
            Fee Tier
            <span class="slider-value" id="feeTierVal">1.0%</span>
          </label>
          <input type="range" id="feeTier" min="5000" max="100000" step="5000" value="10000"
                 oninput="updateSliders(); updatePreview();">
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">
            Trading fee percentage for your token's liquidity pool
          </div>
        </div>
        
        <div class="slider-group">
          <label>
            Liquidity Allocation
            <span class="slider-value" id="lpRateVal">20%</span>
          </label>
          <input type="range" id="lpRate" min="0" max="100" step="5" value="20"
                 oninput="updateSliders(); updatePreview();">
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">
            % of raised BTC going to liquidity (rest goes to creator)
          </div>
        </div>
        
        <div class="slider-group">
          <label>
            Diamond Hands Reward
            <span class="slider-value" id="rewardRateVal">50%</span>
          </label>
          <input type="range" id="rewardRate" min="0" max="100" step="5" value="50"
                 oninput="updateSliders(); updatePreview();">
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">
            Long-term holder reward (% of available 66.67% rewards)
          </div>
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" id="blockWithdrawals" onchange="updatePreview()">
          <label for="blockWithdrawals">
            Block external withdrawals (only internal RadFi transfers allowed)
          </label>
        </div>
        
        <div class="etch-preview">
          <h3>Launch Preview</h3>
          <div class="preview-item">
            <span class="label">Rune Name:</span>
            <span class="value" id="prevName">-</span>
          </div>
          <div class="preview-item">
            <span class="label">Symbol:</span>
            <span class="value" id="prevSymbol">-</span>
          </div>
          <div class="preview-item">
            <span class="label">Fee Tier:</span>
            <span class="value" id="prevFee">1.0%</span>
          </div>
          <div class="preview-item">
            <span class="label">LP Allocation:</span>
            <span class="value" id="prevLP">20%</span>
          </div>
          <div class="preview-item">
            <span class="label">Creator Gets:</span>
            <span class="value" id="prevCreator">80%</span>
          </div>
          <div class="preview-item">
            <span class="label">Diamond Reward:</span>
            <span class="value" id="prevReward">33.33%</span>
          </div>
          <div class="preview-item">
            <span class="label">Withdrawals:</span>
            <span class="value" id="prevWithdraw">Allowed</span>
          </div>
        </div>
        
        <button class="etch-btn" onclick="launchRune()">
          Launch Rune
        </button>
        
        <div class="etch-info">
          ‚ÑπÔ∏è Connect your wallet to etch a new Rune. You'll need BTC for the inscription and etching fees.
        </div>
      </div>
    </div>
    
    <!-- Recently Launched -->
    <div class="etch-list">
      <h2>Recently Launched</h2>
      <div class="etch-items" id="etchedRunes">
        <div style="text-align: center; padding: 2rem; grid-column: 1/-1; color: var(--text-secondary);">
          Loading recently etched Runes...
        </div>
      </div>
    </div>
  </div>

  <!-- LIQUIDITY PAGE (User LP Positions) -->
  <div class="page" id="page-liquidity">
    <div class="mm-header">
      <h1>üíß Liquidity Positions</h1>
      <p>Your active liquidity provider positions on RadFi pools</p>
    </div>
    
    <div class="table-card">
      <table>
        <thead>
          <tr>
            <th>Pool</th>
            <th>Your Liquidity</th>
            <th>Pool Share</th>
            <th>Fees Earned</th>
            <th>APY</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="lpPositionsTbody">
          <tr>
            <td colspan="6" style="text-align: center; padding: 3rem; color: var(--text-secondary);">
              Connect wallet to view your liquidity positions
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- MARKET MAKER PAGE -->
  <div class="page" id="page-market-maker">
    <div class="mm-header">
      <h1>üè¶ RadLabs Market Maker</h1>
      <p>Automated market making strategy ‚Ä¢ 23-32% APY ‚Ä¢ 10% performance fee on profits</p>
    </div>
    
    <div class="mm-grid">
      <div class="mm-card">
        <h2>Deploy Capital</h2>
        <div class="form-group">
          <label>Select Pool</label>
          <select id="mmPool" style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); border-radius: 8px; color: white;">
            <option>Loading pools...</option>
          </select>
        </div>
        <div class="form-group">
          <label>Amount (BTC)</label>
          <input type="number" id="mmAmount" placeholder="0.01" step="0.001" style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); border-radius: 8px; color: white;">
        </div>
        <button class="etch-btn" onclick="deployMM()">Deploy to Market Maker</button>
        <div class="etch-info">
          ‚ÑπÔ∏è Platform earns 10% of profitable fees. You keep 90%. No fees on deposits or losses.
        </div>
      </div>
      
      <div class="mm-card">
        <h2>Strategy Performance</h2>
        <div class="preview-item">
          <span class="label">Expected APY:</span>
          <span class="value">23-32%</span>
        </div>
        <div class="preview-item">
          <span class="label">Fee Split:</span>
          <span class="value">90% You / 10% Platform</span>
        </div>
        <div class="preview-item">
          <span class="label">Active Pools:</span>
          <span class="value" id="mmActivePools">0</span>
        </div>
        <div class="preview-item">
          <span class="label">Total Deployed:</span>
          <span class="value" id="mmTotalDeployed">0 BTC</span>
        </div>
      </div>
    </div>
    
    <div class="table-card" style="margin-top: 2rem;">
      <h2 style="margin-bottom: 1rem;">Your Positions</h2>
      <table>
        <thead>
          <tr>
            <th>Pool</th>
            <th>Deposited</th>
            <th>Current Value</th>
            <th>Fees Earned</th>
            <th>IL</th>
            <th>Total PnL</th>
            <th>APY</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="mmPositionsTbody">
          <tr>
            <td colspan="9" style="text-align: center; padding: 2rem; color: var(--text-secondary);">
              No active positions. Deploy capital to start earning.
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    // Global State
    const S = {
      userAddress: null,
      tradingAddress: null,
      publicKey: null,
      walletType: null,
      accessToken: null,
      refreshToken: null,
      tokens: [],
      pools: [],
      etchedRunes: [],
      lpPositions: [],
      mmPositions: []
    };
    
    const mmState = {
      positions: []
    };
    
    // Wallet Connection (RadFi Trading Wallet Flow)
    async function doConnect() {
      try {
        let address, publicKey, walletType;
        
        // Try Unisat first
        if (window.unisat) {
          const accounts = await window.unisat.requestAccounts();
          address = accounts[0];
          publicKey = await window.unisat.getPublicKey();
          walletType = 'unisat';
        }
        // Try Xverse
        else if (window.XverseProviders?.BitcoinProvider) {
          const provider = window.XverseProviders.BitcoinProvider;
          const response = await provider.request('getAccounts', {
            purposes: ['payment', 'ordinals']
          });
          const paymentAccount = response.find(acc => acc.purpose === 'payment');
          address = paymentAccount.address;
          publicKey = paymentAccount.publicKey;
          walletType = 'xverse';
        }
        // Try OKX
        else if (window.okxwallet?.bitcoin) {
          const accounts = await window.okxwallet.bitcoin.requestAccounts();
          address = accounts[0];
          publicKey = await window.okxwallet.bitcoin.getPublicKey();
          walletType = 'okx';
        }
        else {
          alert('No Bitcoin wallet detected. Please install Unisat, Xverse, or OKX wallet.');
          return;
        }
        
        // Sign authentication message
        const message = `Sign this message to authenticate with RadFi: ${Date.now()}`;
        let signature;
        
        if (walletType === 'unisat') {
          signature = await window.unisat.signMessage(message);
        } else if (walletType === 'xverse') {
          const signResponse = await window.XverseProviders.BitcoinProvider.request('signMessage', {
            address: address,
            message: message
          });
          signature = signResponse.signature;
        } else if (walletType === 'okx') {
          signature = await window.okxwallet.bitcoin.signMessage(message);
        }
        
        // Authenticate with RadFi to get trading wallet
        const authResponse = await fetch('/api/auth/authenticate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            message,
            signature,
            address,
            publicKey
          })
        });
        
        const authData = await authResponse.json();
        
        if (!authData.success) {
          throw new Error(authData.error || 'Authentication failed');
        }
        
        // Store session
        S.userAddress = address;
        S.tradingAddress = authData.tradingAddress;
        S.publicKey = publicKey;
        S.walletType = walletType;
        S.accessToken = authData.accessToken;
        S.refreshToken = authData.refreshToken;
        
        // Save to localStorage
        localStorage.setItem('radfi_session', JSON.stringify({
          userAddress: S.userAddress,
          tradingAddress: S.tradingAddress,
          accessToken: S.accessToken,
          refreshToken: S.refreshToken,
          walletType: S.walletType
        }));
        
        document.getElementById('connectBtn').textContent = 
          `${S.userAddress.slice(0,6)}...${S.userAddress.slice(-4)}`;
        document.getElementById('connectBtn').classList.add('connected');
        
        toast('Wallet connected successfully', 'success');
        
        // Load user data
        await loadLPPositions();
        
      } catch (error) {
        console.error('Connection error:', error);
        toast('Failed to connect wallet: ' + error.message, 'error');
      }
    }
    
    // Restore session from localStorage
    function restoreSession() {
      const stored = localStorage.getItem('radfi_session');
      if (stored) {
        try {
          const session = JSON.parse(stored);
          S.userAddress = session.userAddress;
          S.tradingAddress = session.tradingAddress;
          S.accessToken = session.accessToken;
          S.refreshToken = session.refreshToken;
          S.walletType = session.walletType;
          
          document.getElementById('connectBtn').textContent = 
            `${S.userAddress.slice(0,6)}...${S.userAddress.slice(-4)}`;
          document.getElementById('connectBtn').classList.add('connected');
          
          // Load user data
          loadLPPositions();
        } catch (e) {
          console.error('Failed to restore session:', e);
        }
      }
    }
    
    // Toast notifications
    function toast(msg, type = 'info') {
      const t = document.createElement('div');
      t.className = `toast ${type}`;
      t.textContent = msg;
      document.body.appendChild(t);
      setTimeout(() => t.remove(), 4000);
    }
    
    // Navigation
    function navigate(page) {
      document.querySelectorAll('.nav a').forEach(a => a.classList.remove('active'));
      document.querySelector(`.nav a[data-page="${page}"]`)?.classList.add('active');
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(`page-${page}`)?.classList.add('active');
      
      if (page === 'tokens') loadTokens();
      if (page === 'radpad') loadEtchedRunes();
      if (page === 'liquidity') loadLPPositions();
      if (page === 'market-maker') {
        loadMMLoc();
        renderMMPositions();
      }
    }
    
    document.querySelectorAll('.nav a[data-page]').forEach(a => {
      a.addEventListener('click', e => {
        e.preventDefault();
        navigate(a.dataset.page);
      });
    });
    
    // Load tokens
    async function loadTokens() {
      try {
        const response = await fetch('/api/tokens');
        const data = await response.json();
        S.tokens = data.data || [];
        renderTokens();
      } catch (error) {
        console.error('Failed to load tokens:', error);
      }
    }
    
    function renderTokens() {
      const tbody = document.getElementById('tokenTbody');
      tbody.innerHTML = S.tokens.slice(0, 100).map(t => `
        <tr>
          <td>
            <div style="display: flex; align-items: center; gap: 0.75rem;">
              <span style="font-size: 1.5rem;">${t.emoji || 'ü™ô'}</span>
              <div>
                <div style="font-weight: 600;">${t.name}</div>
                <div style="font-size: 0.85rem; color: var(--text-secondary);">${t.symbol}</div>
              </div>
            </div>
          </td>
          <td style="font-weight: 600;">${fmtCompact(t.marketCap)}</td>
          <td>${fmtCompact(t.volume24h)}</td>
          <td>${fmtCompact(t.liquidity)}</td>
          <td style="color: ${t.priceChange24h >= 0 ? 'var(--green)' : 'var(--red)'};">
            ${t.priceChange24h >= 0 ? '+' : ''}${t.priceChange24h.toFixed(2)}%
          </td>
        </tr>
      `).join('');
    }
    
    function filterTable(q) {
      q = q.toLowerCase();
      document.querySelectorAll('#tokenTbody tr').forEach(r => {
        r.style.display = r.textContent.toLowerCase().includes(q) ? '' : 'none';
      });
    }
    
    // RadPad Functions
    function updateSliders() {
      const feeTier = document.getElementById('feeTier').value;
      const lpRate = document.getElementById('lpRate').value;
      const rewardRate = document.getElementById('rewardRate').value;
      
      document.getElementById('feeTierVal').textContent = (feeTier / 10000).toFixed(1) + '%';
      document.getElementById('lpRateVal').textContent = lpRate + '%';
      document.getElementById('rewardRateVal').textContent = rewardRate + '%';
    }
    
    function updatePreview() {
      const runeName = document.getElementById('runeName').value;
      const symbol = document.getElementById('symbol').value;
      const feeTier = document.getElementById('feeTier').value;
      const lpRate = document.getElementById('lpRate').value;
      const rewardRate = document.getElementById('rewardRate').value;
      const blockWithdrawals = document.getElementById('blockWithdrawals').checked;
      
      document.getElementById('prevName').textContent = runeName || '-';
      document.getElementById('prevSymbol').textContent = symbol || '-';
      document.getElementById('prevFee').textContent = (feeTier / 10000).toFixed(1) + '%';
      document.getElementById('prevLP').textContent = lpRate + '%';
      document.getElementById('prevCreator').textContent = (100 - lpRate) + '%';
      
      // Calculate diamond reward (% of 66.67%)
      const actualReward = (rewardRate / 100) * 66.67;
      document.getElementById('prevReward').textContent = actualReward.toFixed(2) + '%';
      
      document.getElementById('prevWithdraw').textContent = blockWithdrawals ? 'Blocked' : 'Allowed';
    }
    
    async function launchRune() {
      if (!S.accessToken) {
        toast('Please connect your wallet first', 'error');
        return;
      }
      
      const runeName = document.getElementById('runeName').value.trim();
      const symbol = document.getElementById('symbol').value.trim();
      const description = document.getElementById('description').value.trim();
      const inscriptionContent = document.getElementById('inscriptionContent').value.trim();
      
      if (!runeName || !symbol || !description) {
        toast('Please fill in all required fields', 'error');
        return;
      }
      
      try {
        toast('Building commit transaction...', 'info');
        
        const etchParams = {
          runeName,
          inscriptionType: 'text/plain',
          inscriptionContent: inscriptionContent || 'Etched on RadFi',
          userAddress: S.tradingAddress || S.userAddress,
          feeTier: parseInt(document.getElementById('feeTier').value),
          diamondHandRewardRate: parseInt(document.getElementById('rewardRate').value) / 100,
          blockWithdrawals: document.getElementById('blockWithdrawals').checked,
          addLpSatsRate: parseInt(document.getElementById('lpRate').value) / 100
        };
        
        const commitResponse = await fetch('/api/etch/commit-tx', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${S.accessToken}`
          },
          body: JSON.stringify(etchParams)
        });
        
        const commitData = await commitResponse.json();
        
        if (!commitData.success) {
          throw new Error(commitData.error || 'Failed to build commit transaction');
        }
        
        toast('Please sign the transaction in your wallet', 'info');
        
        // Sign PSBT with wallet
        let signedPsbt;
        if (S.walletType === 'unisat') {
          signedPsbt = await window.unisat.signPsbt(commitData.psbt);
        } else if (S.walletType === 'xverse') {
          // Xverse signing flow would go here
          throw new Error('Xverse PSBT signing not implemented yet');
        } else if (S.walletType === 'okx') {
          signedPsbt = await window.okxwallet.bitcoin.signPsbt(commitData.psbt);
        }
        
        // Submit etching
        const submitResponse = await fetch('/api/etch/submit-etching', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${S.accessToken}`
          },
          body: JSON.stringify({
            signedBase64Psbt: signedPsbt,
            runeName,
            inscriptionType: 'text/plain',
            inscriptionContent: inscriptionContent || 'Etched on RadFi',
            symbol,
            creator: S.userAddress,
            description,
            displayTicker: document.getElementById('displayTicker').value || symbol,
            social: {
              x: document.getElementById('socialX').value || undefined,
              telegram: document.getElementById('socialTg').value || undefined
            }
          })
        });
        
        const submitData = await submitResponse.json();
        
        if (!submitData.success) {
          throw new Error(submitData.error || 'Failed to submit etching');
        }
        
        toast('Rune etching submitted successfully! üéâ', 'success');
        
        // Reload etched runes list
        setTimeout(() => loadEtchedRunes(), 2000);
        
      } catch (error) {
        console.error('Launch error:', error);
        toast('Failed to launch rune: ' + error.message, 'error');
      }
    }
    
    async function loadEtchedRunes() {
      try {
        const response = await fetch('/api/etch/runes?pageSize=20&sort=-createdAt');
        const data = await response.json();
        S.etchedRunes = data.data || [];
        renderEtchedRunes();
      } catch (error) {
        console.error('Failed to load etched runes:', error);
      }
    }
    
    function renderEtchedRunes() {
      const container = document.getElementById('etchedRunes');
      if (S.etchedRunes.length === 0) {
        container.innerHTML = '<div style="text-align: center; padding: 2rem; grid-column: 1/-1; color: var(--text-secondary);">No runes etched yet. Be the first!</div>';
        return;
      }
      
      container.innerHTML = S.etchedRunes.map(rune => `
        <div class="etch-item">
          <div class="etch-item-header">
            <div class="etch-item-name">${rune.runeName}</div>
            <div class="etch-item-symbol">${rune.symbol}</div>
          </div>
          <div class="etch-item-description">
            ${rune.description || 'No description provided'}
          </div>
          <div class="etch-item-stats">
            <div class="etch-item-stat">
              <span class="label">Market Cap</span>
              <span class="value">${fmtCompact(rune.marketCap || 0)}</span>
            </div>
            <div class="etch-item-stat">
              <span class="label">Holders</span>
              <span class="value">${rune.holders || 0}</span>
            </div>
            <div class="etch-item-stat">
              <span class="label">Fee Tier</span>
              <span class="value">${((rune.feeTier || 10000) / 10000).toFixed(1)}%</span>
            </div>
            <div class="etch-item-stat">
              <span class="label">LP Allocation</span>
              <span class="value">${((rune.addLpSatsRate || 0) * 100).toFixed(0)}%</span>
            </div>
          </div>
          ${rune.social && (rune.social.x || rune.social.telegram) ? `
            <div class="etch-item-socials">
              ${rune.social.x ? `<a href="${rune.social.x}" class="social-link" target="_blank">ùïè</a>` : ''}
              ${rune.social.telegram ? `<a href="${rune.social.telegram}" class="social-link" target="_blank">üì±</a>` : ''}
            </div>
          ` : ''}
        </div>
      `).join('');
    }
    
    // LP Positions
    async function loadLPPositions() {
      if (!S.tradingAddress && !S.userAddress) return;
      
      try {
        // This would call RadFi API to get user's LP positions
        // For now, show empty state
        const tbody = document.getElementById('lpPositionsTbody');
        tbody.innerHTML = `
          <tr>
            <td colspan="6" style="text-align: center; padding: 2rem; color: var(--text-secondary);">
              No liquidity positions found
            </td>
          </tr>
        `;
      } catch (error) {
        console.error('Failed to load LP positions:', error);
      }
    }
    
    // Market Maker Functions
    function loadMMLoc() {
      const stored = localStorage.getItem('mm_positions');
      if (stored) {
        try {
          mmState.positions = JSON.parse(stored);
          renderMMPositions();
        } catch (e) {
          console.error('Failed to load MM positions:', e);
        }
      }
    }
    
    function saveMMLoc() {
      localStorage.setItem('mm_positions', JSON.stringify(mmState.positions));
    }
    
    function renderMMPositions() {
      const tbody = document.getElementById('mmPositionsTbody');
      
      if (mmState.positions.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="9" style="text-align: center; padding: 2rem; color: var(--text-secondary);">
              No active positions. Deploy capital to start earning.
            </td>
          </tr>
        `;
        return;
      }
      
      tbody.innerHTML = mmState.positions.map((pos, i) => `
        <tr>
          <td>
            <div style="font-weight: 600;">${pos.token?.symbol || 'Unknown'}</div>
            <div style="font-size: 0.85rem; color: var(--text-secondary);">${pos.token?.name || ''}</div>
          </td>
          <td>${pos.depositedBTC.toFixed(4)} BTC</td>
          <td>${pos.currentValue?.toFixed(4) || pos.depositedBTC.toFixed(4)} BTC</td>
          <td style="color: var(--matrix-green);">+${pos.feesEarned?.toFixed(6) || '0.000000'} BTC</td>
          <td style="color: ${(pos.ilLoss || 0) < 0 ? 'var(--red)' : 'var(--text-secondary)'};">
            ${((pos.ilLoss || 0) * 100).toFixed(2)}%
          </td>
          <td style="color: ${(pos.totalPnL || 0) >= 0 ? 'var(--green)' : 'var(--red)'};">
            ${(pos.totalPnL || 0) >= 0 ? '+' : ''}${((pos.totalPnL || 0) * 100).toFixed(2)}%
          </td>
          <td style="color: var(--matrix-green);">${(pos.apy || 0).toFixed(1)}%</td>
          <td>
            <span style="padding: 0.25rem 0.75rem; background: ${pos.status === 'active' ? 'rgba(0,255,136,0.2)' : 'rgba(255,215,61,0.2)'}; border: 1px solid ${pos.status === 'active' ? 'var(--green)' : 'var(--yellow)'}; border-radius: 6px; font-size: 0.85rem;">
              ${pos.status === 'active' ? 'Active' : 'Pending'}
            </span>
          </td>
          <td>
            <button onclick="withdrawMM(${i})" style="padding: 0.5rem 1rem; background: rgba(255,71,87,0.2); border: 1px solid var(--red); border-radius: 6px; color: white; cursor: pointer;">
              Withdraw
            </button>
          </td>
        </tr>
      `).join('');
      
      // Update summary
      document.getElementById('mmActivePools').textContent = mmState.positions.length;
      const totalDeployed = mmState.positions.reduce((sum, pos) => sum + pos.depositedBTC, 0);
      document.getElementById('mmTotalDeployed').textContent = totalDeployed.toFixed(4) + ' BTC';
    }
    
    async function deployMM() {
      if (!S.accessToken) {
        toast('Please connect your wallet first', 'error');
        return;
      }
      
      const poolSelect = document.getElementById('mmPool');
      const amount = parseFloat(document.getElementById('mmAmount').value);
      
      if (!amount || amount <= 0) {
        toast('Please enter a valid amount', 'error');
        return;
      }
      
      // This would integrate with the real MM deployment flow
      toast('Market maker deployment coming soon', 'info');
    }
    
    async function withdrawMM(index) {
      const position = mmState.positions[index];
      
      const profitableFees = Math.max(0, position.feesEarned || 0);
      const platformFee = profitableFees * 0.10;
      const userFees = profitableFees * 0.90;
      const totalReturn = position.depositedBTC + userFees + (position.ilLoss || 0);
      
      const message = `Withdraw from ${position.token?.symbol || 'Unknown'} pool?\n\n` +
        `Principal: ${position.depositedBTC.toFixed(4)} BTC\n` +
        `Fees Earned: ${profitableFees.toFixed(6)} BTC\n` +
        `Your Share (90%): ${userFees.toFixed(6)} BTC\n` +
        `Platform Fee (10%): ${platformFee.toFixed(6)} BTC\n` +
        `Total Return: ${totalReturn.toFixed(6)} BTC`;
      
      if (!confirm(message)) {
        return;
      }
      
      // Remove position
      mmState.positions.splice(index, 1);
      saveMMLoc();
      renderMMPositions();
      toast(`Withdrawal successful. Total: ${totalReturn.toFixed(6)} BTC`, 'success');
    }
    
    // Utility functions
    function fmtNum(n) {
      if (n < 0.00001) return n.toExponential(2);
      if (n < 1) return n.toFixed(6);
      return n.toLocaleString('en-US', { maximumFractionDigits: 4 });
    }
    
    function fmtCompact(n) {
      if (n >= 1e9) return '$' + (n / 1e9).toFixed(2) + 'B';
      if (n >= 1e6) return '$' + (n / 1e6).toFixed(2) + 'M';
      if (n >= 1e3) return '$' + (n / 1e3).toFixed(1) + 'K';
      return '$' + n.toFixed(0);
    }
    
    // Initialize
    restoreSession();
    updateSliders();
    updatePreview();
    loadTokens();
    loadMMLoc();
  </script>
</body>
</html>
