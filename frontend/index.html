<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RadLabs | Bitcoin Runes Trading</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- TradingView Lightweight Charts -->
  <script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>
  <style>
    :root {
      /* Miami Vice Modern Palette */
      --miami-pink: #ff2d92;
      --miami-cyan: #00d4ff;
      --miami-purple: #9945ff;
      --miami-orange: #ff6b35;
      --miami-sunset: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      
      /* Matrix Numbers */
      --matrix-green: #00ff41;
      --matrix-dim: #00cc33;
      
      /* Modern Apple-style */
      --glass-bg: rgba(255,255,255,0.03);
      --glass-border: rgba(255,255,255,0.08);
      --card-bg: rgba(20,20,35,0.8);
      --card-border: rgba(255,255,255,0.06);
      
      /* Base */
      --bg-primary: #0a0a12;
      --bg-secondary: #0f0f1a;
      --text-primary: #ffffff;
      --text-secondary: rgba(255,255,255,0.6);
      --text-muted: rgba(255,255,255,0.4);
      
      /* Status */
      --green: #00ff88;
      --red: #ff4757;
      --yellow: #ffd93d;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    /* ===== BACKGROUND ===== */
    .bg-gradient {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: 
        radial-gradient(ellipse at 20% 20%, rgba(255,45,146,0.15) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(0,212,255,0.1) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 50%, rgba(153,69,255,0.05) 0%, transparent 70%),
        var(--bg-primary);
      z-index: -2;
    }
    
    .bg-grid {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-image: 
        linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
      background-size: 60px 60px;
      z-index: -1;
    }
    
    /* Palm tree decorations */
    .palm-left, .palm-right {
      position: fixed;
      bottom: 0;
      width: 200px;
      height: 400px;
      opacity: 0.1;
      z-index: -1;
      background-size: contain;
      background-repeat: no-repeat;
      filter: hue-rotate(280deg);
    }
    .palm-left { left: 0; }
    .palm-right { right: 0; transform: scaleX(-1); }
    
    /* ===== LOTTERY BANNER ===== */
    .lottery-banner {
      background: linear-gradient(90deg, rgba(255,45,146,0.1), rgba(0,212,255,0.1), rgba(153,69,255,0.1));
      border-bottom: 1px solid var(--glass-border);
      padding: 0.6rem 2rem;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 2rem;
      font-size: 0.85rem;
    }
    
    .lottery-timer {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .lottery-timer .icon {
      font-size: 1.2rem;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .lottery-slots {
      display: flex;
      gap: 0.25rem;
      font-family: 'JetBrains Mono', monospace;
      font-weight: 700;
      font-size: 1.1rem;
    }
    
    .slot-digit {
      background: rgba(0,255,65,0.1);
      border: 1px solid var(--matrix-green);
      color: var(--matrix-green);
      padding: 0.2rem 0.4rem;
      border-radius: 4px;
      min-width: 28px;
      text-align: center;
      text-shadow: 0 0 10px var(--matrix-green);
    }
    
    .lottery-prize {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--yellow);
    }
    
    .lottery-prize .amount {
      font-family: 'JetBrains Mono', monospace;
      font-weight: 700;
      font-size: 1rem;
    }
    
    /* ===== HEADER ===== */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2rem;
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--glass-border);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .logo-icon {
      width: 42px;
      height: 42px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .logo-icon svg {
      width: 100%;
      height: 100%;
      filter: drop-shadow(0 2px 4px rgba(0,255,100,0.3));
    }
    
    .logo-text {
      font-family: 'Inter', sans-serif;
      font-size: 1.7rem;
      font-weight: 900;
      letter-spacing: 0.5px;
    }
    
    .logo-text .rad {
      color: #111111;
      -webkit-text-stroke: 1.5px #ff6b35;
      paint-order: stroke fill;
    }
    
    .logo-text .labs {
      color: #ff6b35;
      font-weight: 900;
      margin-left: 2px;
    }
    
    .nav {
      display: flex;
      gap: 0.25rem;
      background: var(--card-bg);
      padding: 0.25rem;
      border-radius: 12px;
      border: 1px solid var(--card-border);
    }
    
    .nav a {
      color: var(--text-secondary);
      text-decoration: none;
      font-weight: 500;
      font-size: 0.9rem;
      padding: 0.6rem 1.25rem;
      border-radius: 10px;
      transition: all 0.2s;
    }
    
    .nav a:hover {
      color: var(--text-primary);
      background: rgba(255,255,255,0.05);
    }
    
    .nav a.active {
      color: var(--text-primary);
      background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
      border: 2px solid transparent;
      background-image: 
        linear-gradient(135deg, #1a1a1a, #2d2d2d),
        linear-gradient(135deg, var(--miami-pink), var(--miami-cyan));
      background-origin: border-box;
      background-clip: padding-box, border-box;
    }
    
    .connect-btn {
      font-family: inherit;
      background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
      color: white;
      border: 2px solid transparent;
      background-image: 
        linear-gradient(135deg, #1a1a1a, #2d2d2d),
        linear-gradient(135deg, var(--miami-pink), var(--miami-cyan));
      background-origin: border-box;
      background-clip: padding-box, border-box;
      padding: 0.75rem 1.5rem;
      border-radius: 12px;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .connect-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(255,45,146,0.3);
    }
    
    .connect-btn.connected {
      background-image: 
        linear-gradient(135deg, #1a1a1a, #2d2d2d),
        linear-gradient(135deg, var(--green), var(--miami-cyan));
      box-shadow: 0 4px 20px rgba(0,255,136,0.3);
    }
    
    /* ===== PAGES ===== */
    .page {
      display: none;
      padding: 1.5rem 2rem;
      max-width: 1600px;
      margin: 0 auto;
      padding-bottom: 100px;
    }
    
    .page.active { display: block; }
    
    /* ===== TRADE PAGE ===== */
    .trade-grid {
      display: grid;
      grid-template-columns: 1fr 380px;
      gap: 1.5rem;
    }
    
    .chart-card {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border-radius: 16px;
      border: 1px solid var(--card-border);
      overflow: hidden;
    }
    
    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--card-border);
    }
    
    .token-display {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .token-img {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--miami-orange), var(--miami-pink));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      border: 2px solid var(--card-border);
      overflow: hidden;
    }
    
    .token-img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .token-meta h2 {
      font-size: 1.25rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .token-meta .rune {
      font-size: 0.8rem;
      color: var(--text-muted);
      font-weight: 400;
    }
    
    .token-stats {
      display: flex;
      gap: 1.5rem;
      margin-top: 0.25rem;
    }
    
    .token-stats span {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }
    
    .token-stats .val {
      font-family: 'JetBrains Mono', monospace;
      color: var(--matrix-green);
    }
    
    .price-box {
      text-align: right;
    }
    
    .price-box .price {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--matrix-green);
      text-shadow: 0 0 20px rgba(0,255,65,0.3);
    }
    
    .price-box .price-usd {
      font-size: 0.9rem;
      color: var(--text-secondary);
    }
    
    .price-box .change {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.95rem;
      font-weight: 600;
    }
    
    .change.up { color: var(--green); }
    .change.down { color: var(--red); }
    
    /* Chart Container */
    .chart-container {
      position: relative;
      height: 400px;
    }
    
    .chart-video-bg {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      min-width: 100%;
      min-height: 100%;
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0.5;
      z-index: 0;
      pointer-events: none;
    }
    
    .mute-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 10;
      background: rgba(0,0,0,0.6);
      border: 1px solid var(--miami-cyan);
      color: var(--miami-cyan);
      padding: 0.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.2rem;
      transition: all 0.2s;
      backdrop-filter: blur(10px);
    }
    
    .mute-btn:hover {
      background: rgba(0,212,255,0.2);
      border-color: var(--miami-cyan);
      transform: scale(1.1);
    }
    
    #tvChart {
      position: relative;
      z-index: 1;
      width: 100%;
      height: 100%;
    }
    
    .chart-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 1rem;
      background: rgba(0,0,0,0.3);
      border-top: 1px solid var(--card-border);
    }
    
    .chart-timeframes {
      display: flex;
      gap: 0.25rem;
    }
    
    .tf-btn {
      font-family: 'JetBrains Mono', monospace;
      background: transparent;
      border: 1px solid var(--card-border);
      color: var(--text-secondary);
      padding: 0.4rem 0.7rem;
      border-radius: 6px;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .tf-btn:hover, .tf-btn.active {
      background: var(--miami-cyan);
      border-color: var(--miami-cyan);
      color: var(--bg-primary);
    }
    
    .chart-type-btns {
      display: flex;
      gap: 0.25rem;
    }
    
    .chart-type-btn {
      background: transparent;
      border: 1px solid var(--card-border);
      color: var(--text-secondary);
      padding: 0.4rem 0.6rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
    }
    
    .chart-type-btn:hover, .chart-type-btn.active {
      background: var(--miami-pink);
      border-color: var(--miami-pink);
      color: white;
    }
    
    /* ===== TRADE PANEL ===== */
    .trade-panel {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    .panel-card {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border-radius: 16px;
      border: 1px solid var(--card-border);
      padding: 1.25rem;
    }
    
    .panel-tabs {
      display: flex;
      background: rgba(0,0,0,0.3);
      border-radius: 10px;
      padding: 0.25rem;
      margin-bottom: 1rem;
    }
    
    .panel-tab {
      flex: 1;
      padding: 0.6rem;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      font-family: inherit;
      font-weight: 600;
      font-size: 0.9rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .panel-tab.active.buy {
      background: var(--green);
      color: var(--bg-primary);
    }
    
    .panel-tab.active.sell {
      background: var(--red);
      color: white;
    }
    
    .quick-amounts {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    
    .quick-btn {
      font-family: 'JetBrains Mono', monospace;
      background: rgba(0,255,136,0.1);
      border: 1px solid var(--green);
      color: var(--green);
      padding: 0.5rem;
      border-radius: 8px;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .quick-btn:hover {
      background: var(--green);
      color: var(--bg-primary);
    }
    
    .input-group {
      background: rgba(0,0,0,0.3);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 0.75rem;
    }
    
    .input-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
      gap: 0.5rem;
    }
    
    .input-label > span {
      white-space: nowrap;
    }
    
    .input-row {
      display: flex;
      gap: 0.75rem;
      align-items: center;
      overflow: hidden;
    }
    
    .input-field {
      flex: 1;
      min-width: 0;
      background: transparent;
      border: none;
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.4rem;
      color: var(--matrix-green);
      outline: none;
    }
    
    .input-field::placeholder {
      color: var(--text-muted);
    }
    
    .token-select {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--card-border);
      padding: 0.5rem 0.75rem;
      border-radius: 20px;
      cursor: pointer;
      flex-shrink: 0;
      white-space: nowrap;
      max-width: 120px;
    }
    
    .token-select span {
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .token-select .mini-img {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--miami-orange), var(--miami-pink));
    }
    
    .swap-arrow {
      display: flex;
      justify-content: center;
      margin: -0.5rem 0;
      position: relative;
      z-index: 2;
    }
    
    .swap-arrow button {
      background: var(--card-bg);
      border: 2px solid var(--miami-cyan);
      color: var(--miami-cyan);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.3s;
    }
    
    .swap-arrow button:hover {
      background: var(--miami-cyan);
      color: var(--bg-primary);
      transform: rotate(180deg);
    }
    
    .trade-info {
      padding: 0.75rem 0;
      border-top: 1px solid var(--card-border);
      margin-top: 0.5rem;
    }
    
    .info-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      margin-bottom: 0.4rem;
    }
    
    .info-row .label { color: var(--text-muted); }
    .info-row .value { 
      font-family: 'JetBrains Mono', monospace;
      color: var(--text-primary);
    }
    .info-row .value.fee { color: var(--miami-pink); }
    
    .trade-btn {
      width: 100%;
      padding: 1rem;
      border: none;
      border-radius: 12px;
      font-family: inherit;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 0.5rem;
    }
    
    .trade-btn.buy {
      background: linear-gradient(135deg, var(--green), #00cc77);
      color: var(--bg-primary);
      box-shadow: 0 4px 20px rgba(0,255,136,0.3);
    }
    
    .trade-btn.sell {
      background: linear-gradient(135deg, var(--red), #cc3344);
      color: white;
      box-shadow: 0 4px 20px rgba(255,71,87,0.3);
    }
    
    .trade-btn:disabled {
      background: var(--card-bg);
      color: var(--text-muted);
      box-shadow: none;
      cursor: not-allowed;
    }
    
    /* Health indicator */
    .health-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
    }
    
    .health-badge {
      background: rgba(0,255,136,0.1);
      color: var(--green);
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    
    /* ===== TOKEN TABLE ===== */
    .token-list-card {
      margin-top: 1.5rem;
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border-radius: 16px;
      border: 1px solid var(--card-border);
      overflow: hidden;
    }
    
    .list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--card-border);
    }
    
    .list-header h3 {
      font-size: 1.1rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .live-dot {
      width: 8px;
      height: 8px;
      background: var(--green);
      border-radius: 50%;
      animation: pulse 2s infinite;
    }
    
    .search-box {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(0,0,0,0.3);
      border: 1px solid var(--card-border);
      border-radius: 10px;
      padding: 0.5rem 1rem;
    }
    
    .search-box input {
      background: transparent;
      border: none;
      color: var(--text-primary);
      font-family: inherit;
      font-size: 0.9rem;
      outline: none;
      width: 200px;
    }
    
    .token-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .token-table th {
      text-align: left;
      padding: 0.75rem 1rem;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      background: rgba(0,0,0,0.2);
      border-bottom: 1px solid var(--card-border);
    }
    
    .token-table td {
      padding: 0.75rem 1rem;
      border-bottom: 1px solid var(--card-border);
      font-size: 0.9rem;
    }
    
    .token-table tbody tr {
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .token-table tbody tr:hover {
      background: rgba(255,45,146,0.05);
    }
    
    .token-cell {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .token-cell .img {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--miami-orange), var(--miami-pink));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      overflow: hidden;
    }
    
    .token-cell .img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .token-cell .name {
      font-weight: 600;
    }
    
    .token-cell .rune {
      font-size: 0.75rem;
      color: var(--text-muted);
    }
    
    .mono {
      font-family: 'JetBrains Mono', monospace;
    }
    
    .green { color: var(--matrix-green) !important; }
    .up { color: var(--green) !important; }
    .down { color: var(--red) !important; }
    
    /* ===== GAMES PAGE ===== */
    .games-header {
      text-align: center;
      padding: 2rem 0;
    }
    
    .games-header h1 {
      font-size: 2.5rem;
      font-weight: 800;
      background: linear-gradient(90deg, var(--miami-pink), var(--miami-cyan), var(--miami-purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 0.5rem;
    }
    
    .games-header p {
      color: var(--text-secondary);
      font-size: 1.1rem;
    }
    
    .games-header .rake-info {
      display: inline-block;
      background: rgba(255,45,146,0.1);
      border: 1px solid var(--miami-pink);
      color: var(--miami-pink);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      margin-top: 1rem;
      font-size: 0.9rem;
    }
    
    .games-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 1.5rem;
      margin-top: 1.5rem;
    }
    
    .game-card {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border-radius: 16px;
      border: 1px solid var(--card-border);
      overflow: hidden;
      transition: all 0.3s;
    }
    
    .game-card:hover {
      border-color: var(--miami-pink);
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(255,45,146,0.2);
    }
    
    .game-preview {
      height: 200px;
      background: linear-gradient(135deg, var(--bg-secondary), var(--bg-primary));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 4rem;
      position: relative;
      overflow: hidden;
    }
    
    .game-preview .bg-anim {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: linear-gradient(45deg, transparent 30%, rgba(255,45,146,0.1) 50%, transparent 70%);
      animation: shine 3s infinite;
    }
    
    @keyframes shine {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    
    .game-info {
      padding: 1.25rem;
    }
    
    .game-info h3 {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }
    
    .game-info p {
      color: var(--text-secondary);
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }
    
    .game-stats {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    
    .game-stat {
      flex: 1;
      background: rgba(0,0,0,0.3);
      padding: 0.5rem;
      border-radius: 8px;
      text-align: center;
    }
    
    .game-stat .label {
      font-size: 0.7rem;
      color: var(--text-muted);
      text-transform: uppercase;
    }
    
    .game-stat .value {
      font-family: 'JetBrains Mono', monospace;
      color: var(--matrix-green);
      font-weight: 600;
    }
    
    .play-btn {
      width: 100%;
      padding: 0.75rem;
      background: linear-gradient(135deg, var(--miami-pink), var(--miami-purple));
      border: none;
      border-radius: 10px;
      color: white;
      font-family: inherit;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .play-btn:hover {
      box-shadow: 0 4px 20px rgba(255,45,146,0.4);
    }
    
    /* Crash Game */
    .crash-game {
      background: var(--card-bg);
      border-radius: 16px;
      border: 1px solid var(--card-border);
      padding: 1.5rem;
      margin-top: 1.5rem;
    }
    
    .crash-display {
      height: 300px;
      background: rgba(0,0,0,0.3);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }
    
    .crash-multiplier {
      font-family: 'JetBrains Mono', monospace;
      font-size: 5rem;
      font-weight: 700;
      color: var(--matrix-green);
      text-shadow: 0 0 40px rgba(0,255,65,0.5);
    }
    
    .crash-multiplier.crashed {
      color: var(--red);
      text-shadow: 0 0 40px rgba(255,71,87,0.5);
    }
    
    .crash-controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-top: 1rem;
    }
    
    .crash-input {
      background: rgba(0,0,0,0.3);
      border: 1px solid var(--card-border);
      border-radius: 10px;
      padding: 1rem;
    }
    
    .crash-input label {
      display: block;
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
    }
    
    .crash-input input {
      width: 100%;
      background: transparent;
      border: none;
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.25rem;
      color: var(--matrix-green);
      outline: none;
    }
    
    .crash-btns {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }
    
    .crash-btns button {
      flex: 1;
      padding: 1rem;
      border: none;
      border-radius: 10px;
      font-family: inherit;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
    }
    
    .bet-btn {
      background: linear-gradient(135deg, var(--green), #00cc77);
      color: var(--bg-primary);
    }
    
    .cashout-btn {
      background: linear-gradient(135deg, var(--miami-pink), var(--miami-purple));
      color: white;
    }
    
    /* ===== MODALS ===== */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(10px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal-overlay.active { display: flex; }
    
    .modal {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      border: 1px solid var(--card-border);
      padding: 1.5rem;
      width: 90%;
      max-width: 420px;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .modal h3 {
      font-size: 1.25rem;
      font-weight: 700;
      text-align: center;
      margin-bottom: 1.5rem;
    }
    
    .wallet-option {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      background: rgba(0,0,0,0.3);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      cursor: pointer;
      margin-bottom: 0.75rem;
      transition: all 0.2s;
    }
    
    .wallet-option:hover {
      border-color: var(--miami-pink);
      background: rgba(255,45,146,0.05);
    }
    
    .wallet-option img {
      width: 44px;
      height: 44px;
      border-radius: 10px;
    }
    
    .wallet-option .name {
      font-weight: 600;
    }
    
    .wallet-option .desc {
      font-size: 0.85rem;
      color: var(--text-muted);
    }
    
    /* ===== TICKER ===== */
    .ticker {
      position: fixed;
      bottom: 0; left: 0;
      width: 100%;
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border-top: 1px solid var(--card-border);
      padding: 0.6rem 0;
      z-index: 99;
      overflow: hidden;
    }
    
    .ticker-track {
      display: flex;
      animation: scroll 50s linear infinite;
      white-space: nowrap;
    }
    
    @keyframes scroll {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }
    
    .ticker-item {
      display: inline-flex;
      align-items: center;
      gap: 0.75rem;
      margin-right: 2.5rem;
      font-size: 0.85rem;
    }
    
    .ticker-item .sym {
      font-weight: 600;
      color: var(--miami-cyan);
    }
    
    .ticker-item .price {
      font-family: 'JetBrains Mono', monospace;
    }
    
    /* ===== TOAST ===== */
    .toast {
      position: fixed;
      bottom: 5rem;
      right: 2rem;
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--card-border);
      border-radius: 12px;
      padding: 1rem 1.5rem;
      transform: translateX(calc(100% + 3rem));
      transition: transform 0.3s;
      z-index: 1001;
    }
    
    .toast.show { transform: translateX(0); }
    .toast.success { border-color: var(--green); }
    .toast.error { border-color: var(--red); }
    
    /* ===== RESPONSIVE ===== */
    @media (max-width: 1024px) {
      .trade-grid { grid-template-columns: 1fr; }
      .trade-panel { order: -1; }
    }
    
    @media (max-width: 768px) {
      .header { flex-wrap: wrap; gap: 1rem; }
      .nav { display: none; }
      .lottery-banner { flex-wrap: wrap; gap: 1rem; padding: 0.75rem 1rem; }
      .page { padding: 1rem; }
      .quick-amounts { grid-template-columns: repeat(2, 1fr); }
    }
  </style>
</head>
<body>
  <div class="bg-gradient"></div>
  <div class="bg-grid"></div>
  
  <!-- Lottery Banner -->
  <div class="lottery-banner">
    <div class="lottery-timer">
      <span class="icon">üé∞</span>
      <span>NEXT WINNER IN</span>
      <div class="lottery-slots">
        <span class="slot-digit" id="hr1">0</span>
        <span class="slot-digit" id="hr2">0</span>
        <span>:</span>
        <span class="slot-digit" id="min1">0</span>
        <span class="slot-digit" id="min2">0</span>
        <span>:</span>
        <span class="slot-digit" id="sec1">0</span>
        <span class="slot-digit" id="sec2">0</span>
      </div>
    </div>
    <div class="lottery-prize">
      <span>üèÜ JACKPOT:</span>
      <span class="amount" id="jackpot">0.00125 BTC</span>
    </div>
    <div style="color:var(--text-secondary);font-size:0.8rem">
      0.25% of fees ‚Üí Random trader wins!
    </div>
  </div>

  <!-- Header -->
  <header class="header">
    <div class="logo">
      <div class="logo-icon">
        <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
          <!-- Flask outline -->
          <path d="M15 4h10v2h-10zM15 6v10l-7 16c-1 2.5 1 5 4 5h16c3 0 5-2.5 4-5l-7-16V6" 
                stroke="#1a1a1a" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
          <!-- Green liquid fill -->
          <path d="M10 28l5-10h10l5 10c1 2-0.5 4-2.5 4h-15c-2 0-3.5-2-2.5-4z" fill="url(#greenLiquid)"/>
          <!-- Bubbles -->
          <circle cx="16" cy="30" r="1.5" fill="#7fff7f">
            <animate attributeName="cy" values="30;26;30" dur="1.5s" repeatCount="indefinite"/>
          </circle>
          <circle cx="24" cy="28" r="2" fill="#7fff7f">
            <animate attributeName="cy" values="28;23;28" dur="2s" repeatCount="indefinite"/>
          </circle>
          <circle cx="20" cy="32" r="1.2" fill="#7fff7f">
            <animate attributeName="cy" values="32;27;32" dur="1.8s" repeatCount="indefinite"/>
          </circle>
          <!-- Highlight -->
          <path d="M12 26l2 6" stroke="rgba(255,255,255,0.4)" stroke-width="1.5" stroke-linecap="round"/>
          <defs>
            <linearGradient id="greenLiquid" x1="20" y1="18" x2="20" y2="36" gradientUnits="userSpaceOnUse">
              <stop offset="0%" stop-color="#00ff66"/>
              <stop offset="100%" stop-color="#00aa44"/>
            </linearGradient>
          </defs>
        </svg>
      </div>
      <span class="logo-text"><span class="rad">Rad</span><span class="labs">Labs</span></span>
    </div>
    
    <nav class="nav">
      <a href="#" class="active" data-page="trade">Trade</a>
      <a href="#" data-page="tokens">Tokens</a>
      <a href="#" data-page="games">Games</a>
      <a href="https://app.radfi.co/explore" target="_blank">RadFi ‚Üó</a>
    </nav>
    
    <button class="connect-btn" id="connectBtn" onclick="connectWallet()">Connect Wallet</button>
  </header>

  <!-- TRADE PAGE -->
  <div class="page active" id="page-trade">
    <div class="trade-grid">
      <div class="chart-card">
        <div class="chart-header">
          <div class="token-display">
            <div class="token-img" id="chartImg">üçº</div>
            <div class="token-meta">
              <h2><span id="chartName">BOTT</span> <span class="rune" id="chartRune">BABY‚Ä¢BOTTLE</span></h2>
              <div class="token-stats">
                <span>MCap: <span class="val" id="chartMcap">$2.19M</span></span>
                <span>Vol: <span class="val" id="chartVol">$7.9K</span></span>
                <span>Liq: <span class="val" id="chartLiq">$4.3M</span></span>
              </div>
            </div>
          </div>
          <div class="price-box">
            <div class="price" id="chartPrice">2.81 sats</div>
            <div class="price-usd" id="chartUsd">‚âà $0.00219</div>
            <div class="change up" id="chartChange">+5.2%</div>
          </div>
        </div>
        
        <div class="chart-container">
          <video id="bgVideo" class="chart-video-bg" autoplay muted loop playsinline>
            <source src="assets/powell.mp4" type="video/mp4">
          </video>
          <button class="mute-btn" id="muteBtn" onclick="toggleMute()">üîá</button>
          <div id="tvChart"></div>
        </div>
        
        <div class="chart-controls">
          <div class="chart-timeframes">
            <button class="tf-btn" data-tf="1">1m</button>
            <button class="tf-btn" data-tf="5">5m</button>
            <button class="tf-btn active" data-tf="15">15m</button>
            <button class="tf-btn" data-tf="60">1H</button>
            <button class="tf-btn" data-tf="240">4H</button>
            <button class="tf-btn" data-tf="1440">1D</button>
          </div>
          <div class="chart-type-btns">
            <button class="chart-type-btn" onclick="setChartType('Line')" title="Line">üìà</button>
            <button class="chart-type-btn active" onclick="setChartType('Candle')" title="Candles">üïØÔ∏è</button>
          </div>
        </div>
      </div>

      <div class="trade-panel">
        <div class="panel-card">
          <div class="panel-tabs">
            <button class="panel-tab active buy" onclick="setTradeMode('buy')">Buy</button>
            <button class="panel-tab sell" onclick="setTradeMode('sell')">Sell</button>
          </div>
          
          <div class="quick-amounts">
            <button class="quick-btn" onclick="setAmt(0.0001)">0.0001</button>
            <button class="quick-btn" onclick="setAmt(0.0005)">0.0005</button>
            <button class="quick-btn" onclick="setAmt(0.001)">0.001</button>
            <button class="quick-btn" onclick="setAmt(0.003)">0.003</button>
          </div>
          
          <div class="input-group">
            <div class="input-label">
              <span>You Pay</span>
              <span>Balance: <span id="fromBal">0.00</span></span>
            </div>
            <div class="input-row">
              <input type="number" class="input-field" id="fromAmt" placeholder="0.0" oninput="calcQuote()">
              <div class="token-select" onclick="openTokenModal('from')">
                <div class="mini-img" style="background:linear-gradient(135deg,#f7931a,#ff6600)">‚Çø</div>
                <span id="fromSym">BTC</span>
                <span>‚ñº</span>
              </div>
            </div>
          </div>
          
          <div class="swap-arrow">
            <button onclick="flipTokens()">‚Üì</button>
          </div>
          
          <div class="input-group">
            <div class="input-label">
              <span>You Receive</span>
              <span>Balance: <span id="toBal">0.00</span></span>
            </div>
            <div class="input-row">
              <input type="number" class="input-field" id="toAmt" placeholder="0.0" readonly>
              <div class="token-select" onclick="openTokenModal('to')">
                <div class="mini-img" id="toMiniImg">üçº</div>
                <span id="toSym">BOTT</span>
                <span>‚ñº</span>
              </div>
            </div>
          </div>
          
          <div class="health-row">
            <span style="color:var(--text-muted);font-size:0.85rem">Liquidity Health</span>
            <span class="health-badge">HIGH</span>
          </div>
          
          <div class="trade-info">
            <div class="info-row"><span class="label">Rate</span><span class="value" id="rate">1 BTC = 355,618 BOTT</span></div>
            <div class="info-row"><span class="label">Price Impact</span><span class="value" id="impact">~0.15%</span></div>
            <div class="info-row"><span class="label">Platform Fee (1%)</span><span class="value fee" id="fee">0.00001 BTC</span></div>
            <div class="info-row"><span class="label">Network Fee</span><span class="value">~500 sats</span></div>
          </div>
          
          <button class="trade-btn buy" id="tradeBtn" onclick="handleTrade()">Connect Wallet</button>
        </div>
      </div>
    </div>

    <div class="token-list-card">
      <div class="list-header">
        <h3><span class="live-dot"></span> RADFI TOKENS (LIVE)</h3>
        <div class="search-box">
          <span>üîç</span>
          <input type="text" placeholder="Search..." oninput="filterTable(this.value)">
        </div>
      </div>
      <table class="token-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Token</th>
            <th>Price (sats)</th>
            <th>Price (USD)</th>
            <th>24h</th>
            <th>Market Cap</th>
            <th>Volume 24h</th>
          </tr>
        </thead>
        <tbody id="tokenTbody">
          <tr><td colspan="7" style="text-align:center;padding:2rem;color:var(--text-muted)">Loading...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- TOKENS PAGE -->
  <div class="page" id="page-tokens">
    <div style="text-align:center;padding:2rem 0">
      <h1 style="font-size:2.5rem;font-weight:800;background:linear-gradient(90deg,var(--miami-pink),var(--miami-cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent">All RadFi Tokens</h1>
      <p style="color:var(--text-secondary);margin-top:0.5rem">Live data from RadFi production API</p>
    </div>
    <div class="token-list-card" style="margin-top:0">
      <div class="list-header">
        <h3>Complete Token List</h3>
        <div class="search-box">
          <span>üîç</span>
          <input type="text" placeholder="Search..." oninput="filterAllTable(this.value)">
        </div>
      </div>
      <table class="token-table">
        <thead>
          <tr><th>#</th><th>Token</th><th>Price (sats)</th><th>Price (USD)</th><th>24h</th><th>MCap</th><th>Vol 24h</th><th>All Time Vol</th></tr>
        </thead>
        <tbody id="allTokensTbody"></tbody>
      </table>
    </div>
  </div>

  <!-- GAMES PAGE -->
  <div class="page" id="page-games">
    <div class="games-header">
      <h1>üéÆ GAMES</h1>
      <p>Bet BTC. Win Big. Have Fun.</p>
      <div class="rake-info">2% rake fee ‚Üí $RAD buybacks üî•</div>
    </div>

    <!-- Crash Game -->
    <div class="crash-game">
      <h3 style="margin-bottom:1rem;font-size:1.5rem">üöÄ Crypto Crash</h3>
      <div class="crash-display">
        <div class="crash-multiplier" id="crashMultiplier">1.00x</div>
      </div>
      <div class="crash-controls">
        <div class="crash-input">
          <label>Bet Amount (BTC)</label>
          <input type="number" id="crashBet" value="0.0001" step="0.0001">
        </div>
        <div class="crash-input">
          <label>Auto Cashout At</label>
          <input type="number" id="crashAuto" value="2.00" step="0.1">
        </div>
      </div>
      <div class="crash-btns">
        <button class="bet-btn" onclick="placeCrashBet()">Place Bet</button>
        <button class="cashout-btn" onclick="cashoutCrash()" disabled id="cashoutBtn">Cash Out</button>
      </div>
      <div style="margin-top:1rem;padding:1rem;background:rgba(0,0,0,0.3);border-radius:10px">
        <div style="display:flex;justify-content:space-between;font-size:0.9rem;color:var(--text-secondary)">
          <span>Players this round: <span style="color:var(--matrix-green)">47</span></span>
          <span>Total pot: <span style="color:var(--yellow)">0.0234 BTC</span></span>
        </div>
      </div>
    </div>

    <div class="games-grid">
      <div class="game-card">
        <div class="game-preview">
          <div class="bg-anim"></div>
          <span>üé≤</span>
        </div>
        <div class="game-info">
          <h3>Satoshi Dice</h3>
          <p>Classic provably fair dice. Roll under your target to win!</p>
          <div class="game-stats">
            <div class="game-stat"><div class="label">Players</div><div class="value">124</div></div>
            <div class="game-stat"><div class="label">Wagered</div><div class="value">2.4 BTC</div></div>
            <div class="game-stat"><div class="label">Max Win</div><div class="value">99x</div></div>
          </div>
          <button class="play-btn">Play Now</button>
        </div>
      </div>

      <div class="game-card">
        <div class="game-preview">
          <div class="bg-anim"></div>
          <span>üé∞</span>
        </div>
        <div class="game-info">
          <h3>Rune Slots</h3>
          <p>Match 3 runes to win. Jackpot up to 1000x!</p>
          <div class="game-stats">
            <div class="game-stat"><div class="label">Jackpot</div><div class="value">0.5 BTC</div></div>
            <div class="game-stat"><div class="label">Spins</div><div class="value">5.2K</div></div>
            <div class="game-stat"><div class="label">RTP</div><div class="value">96%</div></div>
          </div>
          <button class="play-btn">Play Now</button>
        </div>
      </div>

      <div class="game-card">
        <div class="game-preview">
          <div class="bg-anim"></div>
          <span>‚ö°</span>
        </div>
        <div class="game-info">
          <h3>Lightning Roulette</h3>
          <p>European roulette with random multipliers up to 500x!</p>
          <div class="game-stats">
            <div class="game-stat"><div class="label">Players</div><div class="value">89</div></div>
            <div class="game-stat"><div class="label">24h Vol</div><div class="value">1.8 BTC</div></div>
            <div class="game-stat"><div class="label">Max Multi</div><div class="value">500x</div></div>
          </div>
          <button class="play-btn">Play Now</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Ticker -->
  <div class="ticker">
    <div class="ticker-track" id="ticker"></div>
  </div>

  <!-- Wallet Modal -->
  <div class="modal-overlay" id="walletModal">
    <div class="modal">
      <h3>Connect Wallet</h3>
      <div class="wallet-option" onclick="doConnect('unisat')">
        <img src="https://unisat.io/favicon.ico" alt="Unisat">
        <div><div class="name">Unisat</div><div class="desc">Bitcoin & Ordinals</div></div>
      </div>
      <div class="wallet-option" onclick="doConnect('xverse')">
        <img src="https://www.xverse.app/favicon.ico" alt="Xverse">
        <div><div class="name">Xverse</div><div class="desc">Bitcoin & Stacks</div></div>
      </div>
      <div class="wallet-option" onclick="doConnect('okx')">
        <img src="https://www.okx.com/favicon.ico" alt="OKX">
        <div><div class="name">OKX Wallet</div><div class="desc">Multi-chain</div></div>
      </div>
    </div>
  </div>

  <!-- Token Modal -->
  <div class="modal-overlay" id="tokenModal">
    <div class="modal">
      <h3>Select Token</h3>
      <div class="search-box" style="margin-bottom:1rem">
        <span>üîç</span>
        <input type="text" placeholder="Search..." oninput="filterModal(this.value)" style="width:100%">
      </div>
      <div id="tokenModalList" style="max-height:400px;overflow-y:auto"></div>
    </div>
  </div>

  <div class="toast" id="toast"><span id="toastMsg"></span></div>

  <script>
    // STATE
    const S = {
      tokens: [],
      address: null,
      mode: 'buy',
      from: { symbol: 'BTC', tokenId: '0:0', priceInSats: 100000000 },
      to: null,
      selected: null,
      selectTarget: 'to',
      chart: null,
      candleSeries: null,
      lineSeries: null,
      chartType: 'Candle',
      timeframe: 15 // minutes per candle
    };

    // LOTTERY TIMER
    function updateLotteryTimer() {
      const now = new Date();
      const endOfDay = new Date(now);
      endOfDay.setHours(23, 59, 59, 999);
      const diff = endOfDay - now;
      
      const hrs = Math.floor(diff / 3600000);
      const mins = Math.floor((diff % 3600000) / 60000);
      const secs = Math.floor((diff % 60000) / 1000);
      
      document.getElementById('hr1').textContent = Math.floor(hrs / 10);
      document.getElementById('hr2').textContent = hrs % 10;
      document.getElementById('min1').textContent = Math.floor(mins / 10);
      document.getElementById('min2').textContent = mins % 10;
      document.getElementById('sec1').textContent = Math.floor(secs / 10);
      document.getElementById('sec2').textContent = secs % 10;
    }
    setInterval(updateLotteryTimer, 1000);
    updateLotteryTimer();

    // CRASH GAME
    let crashInterval = null;
    let crashMultiplier = 1.0;
    let crashBetPlaced = false;

    function placeCrashBet() {
      if (!S.address) { connectWallet(); return; }
      if (crashBetPlaced) return;
      
      crashBetPlaced = true;
      crashMultiplier = 1.0;
      document.getElementById('cashoutBtn').disabled = false;
      
      crashInterval = setInterval(() => {
        crashMultiplier *= 1.01 + Math.random() * 0.02;
        document.getElementById('crashMultiplier').textContent = crashMultiplier.toFixed(2) + 'x';
        
        // Random crash
        if (Math.random() < 0.01 || crashMultiplier > 10) {
          clearInterval(crashInterval);
          document.getElementById('crashMultiplier').classList.add('crashed');
          document.getElementById('crashMultiplier').textContent = 'CRASHED!';
          document.getElementById('cashoutBtn').disabled = true;
          crashBetPlaced = false;
          
          setTimeout(() => {
            document.getElementById('crashMultiplier').classList.remove('crashed');
            document.getElementById('crashMultiplier').textContent = '1.00x';
          }, 2000);
        }
      }, 100);
    }

    function cashoutCrash() {
      if (!crashBetPlaced) return;
      clearInterval(crashInterval);
      crashBetPlaced = false;
      document.getElementById('cashoutBtn').disabled = true;
      
      const bet = parseFloat(document.getElementById('crashBet').value);
      const win = bet * crashMultiplier;
      toast(`Cashed out at ${crashMultiplier.toFixed(2)}x! Won ${win.toFixed(6)} BTC`, 'success');
    }

    // API
    const API = '';

    async function loadTokens() {
      try {
        const res = await fetch(`${API}/api/tokens?pageSize=100&sort=-volume24h`);
        const data = await res.json();
        if (data.data) {
          S.tokens = data.data.filter(t => t.hasPool && !t.isTest);
          renderTable();
          renderTicker();
          if (S.tokens.length > 0) {
            selectToken(S.tokens[0]);
            S.to = S.tokens[0];
            updateToDisplay();
          }
        }
      } catch (e) {
        console.error('Load error:', e);
        document.getElementById('tokenTbody').innerHTML = '<tr><td colspan="7" style="text-align:center;padding:2rem;color:var(--red)">Error loading. Ensure backend runs on localhost:3000</td></tr>';
      }
    }

    // RENDER TABLE
    function renderTable() {
      const tbody = document.getElementById('tokenTbody');
      tbody.innerHTML = S.tokens.slice(0, 20).map((t, i) => tokenRow(t, i)).join('');
    }

    function renderAllTokens() {
      const tbody = document.getElementById('allTokensTbody');
      tbody.innerHTML = S.tokens.map((t, i) => tokenRowFull(t, i)).join('');
    }

    function tokenRow(t, i) {
      const name = t.displayTicker || t.symbol || '?';
      const rune = t.spacedRune || '';
      const sats = t.priceInSats || 0;
      const usd = t.price || 0;
      const change = ((t.priceChange24h || 0) - (t.price || 0)) / ((t.price || 1)) * 100;
      const changeDisplay = usd > 0 ? ((change >= 0 ? '+' : '') + change.toFixed(2) + '%') : '0%';
      const changeClass = change >= 0 ? 'up' : 'down';
      const mcap = t.marketCap || 0;
      const vol = t.volume24h || 0;
      
      return `
        <tr onclick='selectToken(${JSON.stringify(t).replace(/'/g, "\\'")})'>
          <td>${i + 1}</td>
          <td>
            <div class="token-cell">
              <div class="img">${t.symbol || '?'}</div>
              <div><div class="name">${name}</div><div class="rune">${rune}</div></div>
            </div>
          </td>
          <td class="mono green">${fmtSats(sats)}</td>
          <td class="mono">$${fmtNum(usd)}</td>
          <td class="mono ${changeClass}">${changeDisplay}</td>
          <td class="mono">$${fmtCompact(mcap)}</td>
          <td class="mono">$${fmtCompact(vol)}</td>
        </tr>
      `;
    }

    function tokenRowFull(t, i) {
      const name = t.displayTicker || t.symbol || '?';
      const rune = t.spacedRune || '';
      const sats = t.priceInSats || 0;
      const usd = t.price || 0;
      const change = ((t.priceChange24h || 0) - (t.price || 0)) / ((t.price || 1)) * 100;
      const changeDisplay = usd > 0 ? ((change >= 0 ? '+' : '') + change.toFixed(2) + '%') : '0%';
      const changeClass = change >= 0 ? 'up' : 'down';
      
      return `
        <tr onclick='selectTokenNav(${JSON.stringify(t).replace(/'/g, "\\'")})'>
          <td>${i + 1}</td>
          <td><div class="token-cell"><div class="img">${t.symbol || '?'}</div><div><div class="name">${name}</div><div class="rune">${rune}</div></div></div></td>
          <td class="mono green">${fmtSats(sats)}</td>
          <td class="mono">$${fmtNum(usd)}</td>
          <td class="mono ${changeClass}">${changeDisplay}</td>
          <td class="mono">$${fmtCompact(t.marketCap || 0)}</td>
          <td class="mono">$${fmtCompact(t.volume24h || 0)}</td>
          <td class="mono">$${fmtCompact(t.volumeAllTime || 0)}</td>
        </tr>
      `;
    }

    function selectTokenNav(t) {
      selectToken(t);
      navigate('trade');
    }

    function renderTicker() {
      const items = S.tokens.slice(0, 15).map(t => {
        const name = t.displayTicker || t.symbol || '?';
        const change = ((t.priceChange24h || 0) - (t.price || 0)) / ((t.price || 1)) * 100;
        const changeClass = change >= 0 ? 'up' : 'down';
        return `
          <span class="ticker-item">
            <span class="sym">${name}</span>
            <span class="price mono">$${fmtCompact(t.marketCap || 0)}</span>
            <span class="${changeClass}">${change >= 0 ? '+' : ''}${change.toFixed(2)}%</span>
          </span>
        `;
      }).join('');
      document.getElementById('ticker').innerHTML = items + items;
    }

    // TOKEN SELECTION
    function selectToken(t) {
      S.selected = t;
      S.to = t;
      updateToDisplay();
      
      const name = t.displayTicker || t.symbol || '?';
      const mcap = t.marketCap || 0;
      document.getElementById('chartImg').textContent = t.symbol || '?';
      document.getElementById('chartName').textContent = name;
      document.getElementById('chartRune').textContent = t.spacedRune || '';
      document.getElementById('chartMcap').textContent = '$' + fmtCompact(mcap);
      document.getElementById('chartVol').textContent = '$' + fmtCompact(t.volume24h || 0);
      document.getElementById('chartLiq').textContent = '$' + fmtCompact(t.volumeAllTime || 0);
      // Show market cap as "price" everywhere
      document.getElementById('chartPrice').textContent = '$' + fmtCompact(mcap);
      document.getElementById('chartUsd').textContent = 'Market Cap';
      
      const change = ((t.priceChange24h || 0) - (t.price || 0)) / ((t.price || 1)) * 100;
      const changeEl = document.getElementById('chartChange');
      changeEl.textContent = `${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
      changeEl.className = `change ${change >= 0 ? 'up' : 'down'}`;
      
      updateChart();
      calcQuote();
    }

    function updateToDisplay() {
      if (S.to) {
        const name = S.to.displayTicker || S.to.symbol || '?';
        document.getElementById('toSym').textContent = name;
        document.getElementById('toMiniImg').textContent = S.to.symbol || '?';
      }
    }

    // CHART (TradingView Lightweight)
    function initChart() {
      const container = document.getElementById('tvChart');
      S.chart = LightweightCharts.createChart(container, {
        width: container.clientWidth,
        height: container.clientHeight,
        layout: {
          background: { type: 'solid', color: 'transparent' },
          textColor: '#888',
        },
        grid: {
          vertLines: { color: 'rgba(0,255,65,0.05)' },
          horzLines: { color: 'rgba(0,255,65,0.05)' },
        },
        crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
        localization: {
          priceFormatter: (price) => {
            if (price >= 1000000) return '$' + (price / 1000000).toFixed(1) + 'M';
            if (price >= 1000) return '$' + (price / 1000).toFixed(0) + 'k';
            return '$' + price.toFixed(0);
          },
        },
        rightPriceScale: { 
          borderColor: 'rgba(255,255,255,0.1)',
          scaleMargins: { top: 0.1, bottom: 0.1 }
        },
        timeScale: { 
          borderColor: 'rgba(255,255,255,0.1)', 
          timeVisible: true,
          rightOffset: 12,
          barSpacing: 6,
          minBarSpacing: 3,
          fixLeftEdge: false,
          fixRightEdge: false
        },
        handleScroll: {
          mouseWheel: true,
          pressedMouseMove: true,
          horzTouchDrag: true,
          vertTouchDrag: true
        },
        handleScale: {
          axisPressedMouseMove: true,
          mouseWheel: true,
          pinch: true
        }
      });
      
      S.candleSeries = S.chart.addCandlestickSeries({
        upColor: '#00ff88',
        downColor: '#ff4757',
        borderUpColor: '#00ff88',
        borderDownColor: '#ff4757',
        wickUpColor: '#00ff88',
        wickDownColor: '#ff4757',
      });
      
      S.lineSeries = S.chart.addLineSeries({
        color: '#00ffff',
        lineWidth: 2,
      });
      S.lineSeries.applyOptions({ visible: false });
      
      window.addEventListener('resize', () => {
        S.chart.applyOptions({ width: container.clientWidth });
      });
    }

    function updateChart() {
      if (!S.selected || !S.candleSeries) return;
      
      // Use market cap for chart values
      const mcap = S.selected.marketCap || 1000000;
      const data = generateCandleData(mcap, S.timeframe);
      S.candleSeries.setData(data);
      
      const lineData = data.map(d => ({ time: d.time, value: d.close }));
      S.lineSeries.setData(lineData);
      
      S.chart.timeScale().fitContent();
    }

    function generateCandleData(currentMcap, timeframeMinutes) {
      const now = Math.floor(Date.now() / 1000);
      const data = [];
      const candleSeconds = timeframeMinutes * 60;
      
      // Calculate number of candles based on timeframe
      let daysToShow;
      if (timeframeMinutes <= 5) daysToShow = 7; // 1 week for 1m/5m
      else if (timeframeMinutes <= 60) daysToShow = 30; // 1 month for 15m/1h
      else if (timeframeMinutes <= 240) daysToShow = 90; // 3 months for 4h
      else daysToShow = 365; // 1 year for 1D
      
      const candlesPerDay = (24 * 60) / timeframeMinutes;
      const totalCandles = Math.floor(daysToShow * candlesPerDay);
      
      // Generate realistic price action with VARIED candle sizes
      for (let i = totalCandles; i >= 0; i--) {
        const time = now - i * candleSeconds;
        const daysFromNow = i / candlesPerDay;
        
        // Create a base price that oscillates around currentMcap
        const monthCycle = Math.sin((daysFromNow / 30) * Math.PI * 2);
        const weekCycle = Math.sin((daysFromNow / 7) * Math.PI * 2);
        
        // Base price oscillates +/- 15% around current market cap
        const baseVariation = (monthCycle * 0.10) + (weekCycle * 0.05);
        const baseMcap = currentMcap * (1 + baseVariation);
        
        // REALISTIC CANDLE SIZES - vary greatly like real trading
        // Some candles are big movers, some are tiny, some are dojis
        const candleType = Math.random();
        let volatility, wickSize;
        
        if (candleType < 0.1) {
          // 10% - Big movers (breakouts/dumps)
          volatility = baseMcap * (0.05 + Math.random() * 0.10); // 5-15% moves
          wickSize = 0.4 + Math.random() * 0.6; // Long wicks
        } else if (candleType < 0.3) {
          // 20% - Medium moves (trending)
          volatility = baseMcap * (0.02 + Math.random() * 0.04); // 2-6% moves
          wickSize = 0.2 + Math.random() * 0.3;
        } else if (candleType < 0.6) {
          // 30% - Small moves (consolidation)
          volatility = baseMcap * (0.005 + Math.random() * 0.015); // 0.5-2% moves
          wickSize = 0.1 + Math.random() * 0.2;
        } else {
          // 40% - Tiny moves / Dojis (low volume)
          volatility = baseMcap * (0.001 + Math.random() * 0.004); // 0.1-0.5% moves
          wickSize = 0.05 + Math.random() * 0.1; // Minimal wicks
        }
        
        const change = (Math.random() - 0.5) * volatility;
        const open = baseMcap;
        const close = baseMcap + change;
        
        // Varied wick sizes - some candles have huge wicks, some tiny
        const bodySize = Math.abs(close - open);
        const wickRange = bodySize * wickSize + (volatility * 0.1);
        
        const high = Math.max(open, close) + (Math.random() * wickRange);
        const low = Math.min(open, close) - (Math.random() * wickRange);
        
        data.push({ time, open, high, low, close });
      }
      
      // Ensure the last candle closes exactly at current market cap
      const lastCandle = data[data.length - 1];
      lastCandle.close = currentMcap;
      lastCandle.high = Math.max(lastCandle.open, currentMcap, lastCandle.high);
      lastCandle.low = Math.min(lastCandle.open, currentMcap, lastCandle.low);
      
      return data;
    }
    
    // Mute/Unmute video
    function toggleMute() {
      const video = document.getElementById('bgVideo');
      const btn = document.getElementById('muteBtn');
      video.muted = !video.muted;
      btn.textContent = video.muted ? 'üîá' : 'üîä';
    }

    function setChartType(type) {
      S.chartType = type;
      document.querySelectorAll('.chart-type-btn').forEach(b => b.classList.remove('active'));
      event.target.classList.add('active');
      
      if (type === 'Line') {
        S.candleSeries.applyOptions({ visible: false });
        S.lineSeries.applyOptions({ visible: true });
      } else {
        S.candleSeries.applyOptions({ visible: true });
        S.lineSeries.applyOptions({ visible: false });
      }
    }

    // TRADE
    function handleTrade() {
      if (!S.address) {
        connectWallet();
        return;
      }
      // Execute trade logic here
      toast('Trade execution coming soon!', 'info');
    }
    
    function setTradeMode(mode) {
      S.mode = mode;
      document.querySelectorAll('.panel-tab').forEach(t => t.classList.remove('active'));
      document.querySelector(`.panel-tab.${mode}`).classList.add('active');
      
      const btn = document.getElementById('tradeBtn');
      btn.className = `trade-btn ${mode}`;
      btn.textContent = S.address ? (mode === 'buy' ? 'Buy' : 'Sell') : 'Connect Wallet';
    }

    function setAmt(amt) {
      document.getElementById('fromAmt').value = amt;
      calcQuote();
    }

    function calcQuote() {
      const amt = parseFloat(document.getElementById('fromAmt').value) || 0;
      if (!amt || !S.to) {
        document.getElementById('toAmt').value = '';
        return;
      }
      const sats = amt * 100000000;
      const fee = sats * 0.01;
      const net = sats - fee;
      const out = S.to.priceInSats > 0 ? net / S.to.priceInSats : 0;
      
      document.getElementById('toAmt').value = out.toFixed(4);
      
      const name = S.to.displayTicker || S.to.symbol || '?';
      document.getElementById('rate').textContent = `1 BTC = ${fmtCompact(100000000 / (S.to.priceInSats || 1))} ${name}`;
      document.getElementById('fee').textContent = `${(fee / 100000000).toFixed(6)} BTC`;
      document.getElementById('impact').textContent = `~${(amt * 0.2).toFixed(2)}%`;
    }

    function flipTokens() {
      const tmp = S.from;
      S.from = S.to;
      S.to = tmp;
      updateToDisplay();
      calcQuote();
    }

    // TOKEN MODAL
    function openTokenModal(target) {
      S.selectTarget = target;
      const list = document.getElementById('tokenModalList');
      const btc = `<div class="wallet-option" onclick="pickToken({symbol:'BTC',tokenId:'0:0',priceInSats:100000000,displayTicker:'BTC'})">
        <div style="width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,#f7931a,#ff6600);display:flex;align-items:center;justify-content:center;font-size:1.5rem">‚Çø</div>
        <div><div class="name">BTC</div><div class="desc">Bitcoin</div></div>
      </div>`;
      const opts = S.tokens.slice(0, 50).map(t => `
        <div class="wallet-option" onclick='pickToken(${JSON.stringify(t).replace(/'/g, "\\'")})'>
          <div style="width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--miami-orange),var(--miami-pink));display:flex;align-items:center;justify-content:center;font-size:1.5rem">${t.symbol || '?'}</div>
          <div><div class="name">${t.displayTicker || t.symbol}</div><div class="desc">${t.spacedRune || ''}</div></div>
        </div>
      `).join('');
      list.innerHTML = btc + opts;
      document.getElementById('tokenModal').classList.add('active');
    }

    function pickToken(t) {
      if (S.selectTarget === 'from') {
        S.from = t;
      } else {
        S.to = t;
        updateToDisplay();
        selectToken(t);
      }
      document.getElementById('tokenModal').classList.remove('active');
      calcQuote();
    }

    function filterModal(q) {
      q = q.toLowerCase();
      document.querySelectorAll('#tokenModalList .wallet-option').forEach(el => {
        el.style.display = el.textContent.toLowerCase().includes(q) ? 'flex' : 'none';
      });
    }

    // WALLET
    function connectWallet() {
      document.getElementById('walletModal').classList.add('active');
    }

    async function doConnect(type) {
      document.getElementById('walletModal').classList.remove('active');
      try {
        let addr = null;
        if (type === 'unisat' && window.unisat) {
          addr = (await window.unisat.requestAccounts())[0];
        } else if (type === 'xverse' && window.XverseProviders) {
          const res = await window.XverseProviders.request('getAccounts', null);
          if (res.result) addr = res.result[0].address;
        } else if (type === 'okx' && window.okxwallet) {
          addr = (await window.okxwallet.bitcoin.connect()).address;
        } else {
          toast(`${type} wallet not installed`, 'error');
          return;
        }
        if (addr) {
          S.address = addr;
          document.getElementById('connectBtn').textContent = addr.slice(0, 6) + '...' + addr.slice(-4);
          document.getElementById('connectBtn').classList.add('connected');
          document.getElementById('tradeBtn').disabled = false;
          document.getElementById('tradeBtn').textContent = S.mode === 'buy' ? 'Buy' : 'Sell';
          toast('Wallet connected!', 'success');
        }
      } catch (e) {
        toast('Connection failed', 'error');
      }
    }

    // NAV
    function navigate(page) {
      document.querySelectorAll('.nav a').forEach(a => a.classList.remove('active'));
      document.querySelector(`.nav a[data-page="${page}"]`)?.classList.add('active');
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(`page-${page}`)?.classList.add('active');
      
      if (page === 'tokens') renderAllTokens();
    }

    document.querySelectorAll('.nav a[data-page]').forEach(a => {
      a.addEventListener('click', e => {
        e.preventDefault();
        navigate(a.dataset.page);
      });
    });

    // FILTER
    function filterTable(q) {
      q = q.toLowerCase();
      document.querySelectorAll('#tokenTbody tr').forEach(r => {
        r.style.display = r.textContent.toLowerCase().includes(q) ? '' : 'none';
      });
    }

    function filterAllTable(q) {
      q = q.toLowerCase();
      document.querySelectorAll('#allTokensTbody tr').forEach(r => {
        r.style.display = r.textContent.toLowerCase().includes(q) ? '' : 'none';
      });
    }

    // UTILS
    function fmtNum(n) {
      if (n < 0.00001) return n.toExponential(2);
      if (n < 1) return n.toFixed(6);
      return n.toLocaleString('en-US', { maximumFractionDigits: 4 });
    }

    function fmtSats(n) {
      if (n < 0.0001) return n.toExponential(2);
      if (n < 1) return n.toFixed(6);
      return n.toFixed(4);
    }

    function fmtCompact(n) {
      if (n >= 1e9) return (n / 1e9).toFixed(2) + 'B';
      if (n >= 1e6) return (n / 1e6).toFixed(2) + 'M';
      if (n >= 1e3) return (n / 1e3).toFixed(2) + 'K';
      return n.toFixed(2);
    }

    function toast(msg, type = 'info') {
      const t = document.getElementById('toast');
      document.getElementById('toastMsg').textContent = msg;
      t.className = `toast ${type} show`;
      setTimeout(() => t.classList.remove('show'), 3000);
    }

    // CLOSE MODALS
    document.querySelectorAll('.modal-overlay').forEach(m => {
      m.addEventListener('click', e => { if (e.target === m) m.classList.remove('active'); });
    });

    // TF BUTTONS
    document.querySelectorAll('.tf-btn').forEach(b => {
      b.addEventListener('click', () => {
        const tf = parseInt(b.getAttribute('data-tf'));
        S.timeframe = tf;
        document.querySelectorAll('.tf-btn').forEach(x => x.classList.remove('active'));
        b.classList.add('active');
        updateChart();
      });
    });

    // INIT
    initChart();
    loadTokens();
  </script>
</body>
</html>
